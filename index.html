<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{SITE_NAME}</title>
    <script src="https://cdn.jsdelivr.net/npm/marked@16.4.1/lib/marked.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.11.1/lib/highlight.min.js"></script>
    <link id="hljs-light" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.11.1/styles/default.min.css">
    <link id="hljs-dark" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.11.1/styles/dracula.min.css" disabled>
    <style>
        :root{--bg:#f8f9fa;--fg:#212529;--bg-card:#fff;--border:#dee2e6;--hover:#f8f9fa;--select:#e3f2fd;--primary:#0d6efd;--spinner:var(--primary);--toggle:#6c757d;}
        body.dark{--bg:#0a0a0a;--fg:#f8f9f9;--bg-card:#161616;--border:#333;--hover:#1f1f1f;--select:#1e40af;--primary:#3b82f6;--spinner:var(--primary);--toggle:#adb5bd;}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--fg);height:100vh;overflow:hidden;display:flex;flex-direction:column;}
        .topbar{display:flex;align-items:center;padding:0 1rem;height:60px;background:var(--bg-card);border-bottom:1px solid var(--border);flex:none;z-index:10;}
        #menu-btn{display:none;background:none;border:none;font-size:1.5rem;cursor:pointer;padding:.5rem;color:var(--fg);}
        #site-title{margin:0 1rem;font-size:1.2rem;flex:1;}
        .topbar-right{display:flex;align-items:center;gap:.5rem;}
        #search{padding:.5rem .75rem;border:1px solid var(--border);border-radius:.375rem;background:var(--bg-card);color:var(--fg);}
        #theme-toggle{border:none;background:none;font-size:1.25rem;cursor:pointer;padding:.5rem;border-radius:.25rem;transition:.2s;}
        #theme-toggle:hover{background:var(--hover);}
        .main{flex:1;display:flex;overflow:hidden;position:relative;}
        .sidebar{width:280px;background:var(--bg-card);border-right:1px solid var(--border);overflow:auto;position:relative;}
        #fileTree{list-style:none;}
        .tree-item{cursor:pointer;user-select:none;display:flex;align-items:center;padding:.5rem 1rem;transition:.2s;}
        .tree-item:hover{background:var(--hover);}
        .tree-item.active{background:var(--select);border-left:3px solid var(--primary);font-weight:500;}
        .toggle{margin-right:.5rem;width:1rem;text-align:center;color:var(--toggle);transition:.2s;}
        .name{flex:1;}
        .children{padding-left:1.5rem;display:none;}
        .tree-item.open > .children{display:block;}
        .content{flex:1;padding:2rem;overflow:auto;background:var(--bg-card);}
        .loading{text-align:center;padding:3rem 1rem;color:var(--fg);}
        .spinner{margin:0 auto 1rem;width:3rem;height:3rem;border:3px solid var(--border);border-top-color:var(--spinner);border-radius:50%;animation:spin 1s linear infinite;}
        @keyframes spin{to{transform:rotate(360deg)};}
        .doc-title{margin-bottom:2rem;color:var(--fg);border-bottom:2px solid var(--border);padding-bottom:.5rem;}
        .overlay{display:none;position:fixed;top:60px;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:99;}
        @media(max-width:768px){#menu-btn{display:block;}.sidebar{position:fixed;top:60px;left:0;bottom:0;width:280px;z-index:100;transform:translateX(-100%);transition:transform .3s ease;}body.sidebar-open .sidebar{transform:translateX(0);}body.sidebar-open .overlay{display:block;}.content{padding:1.5rem;}}
    </style>
</head>
<body>
    <header class="topbar">
        <button id="menu-btn">Menu</button>
        <h1 id="site-title">{SITE_NAME}</h1>
        <div class="topbar-right">
            <input type="text" id="search" placeholder="Vyhledat...">
            <button id="theme-toggle">Moon</button>
        </div>
    </header>
    <div class="overlay" id="overlay"></div>
    <div class="main">
        <nav class="sidebar" id="sidebar">
            <ul id="fileTree"></ul>
        </nav>
        <main class="content" id="content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Načítám...</p>
            </div>
        </main>
    </div>

    <script>
        // CONFIG
        const OWNER = '{OWNER}';
        const REPO = '{REPO}';
        const BRANCH = '{BRANCH}';
        const ROOT_PATH = '{ROOT}';
        const SITE_NAME = '{SITE_NAME}';
        const DEFAULT_FILE = '{DEFAULT_FILE}';

        document.title = SITE_NAME;
        document.getElementById('site-title').textContent = SITE_NAME;

        const API_BASE = `https://api.github.com/repos/${OWNER}/${REPO}/contents`;
        const RAW_BASE = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}`;
        let tree = [];

        async function fetchFiles(path = '') {
            try {
                const url = ROOT_PATH ? `${API_BASE}/${ROOT_PATH}/${path}` : `${API_BASE}/${path}`;
                const res = await fetch(`${url}?ref=${BRANCH}`);
                const data = await res.json();
                return Array.isArray(data) ? data.filter(item => 
                    item.type === 'file' && item.name.endsWith('.md') || item.type === 'dir'
                ).sort((a,b) => {
                    if (a.type !== b.type) return a.type === 'dir' ? -1 : 1;
                    return a.name.localeCompare(b.name);
                }) : [];
            } catch (e) { console.error(e); return []; }
        }

        async function buildTree(path = '', depth = 0) {
            const items = await fetchFiles(path);
            const nodes = [];
            for (const item of items) {
                if (item.type === 'dir') {
                    const children = await buildTree(item.path, depth + 1);
                    nodes.push({ type: 'dir', name: item.name, path: item.path, children, depth, open: false });
                } else {
                    nodes.push({ type: 'file', name: item.name.replace('.md',''), path: item.path, depth });
                }
            }
            return nodes;
        }

        function renderTree(nodes, parent) {
            nodes.forEach(node => {
                const li = document.createElement('li');
                li.className = 'tree-item';
                if (node.type === 'dir') li.classList.add(node.open ? 'open' : 'collapsed');
                // OPRAVENO: Používá symboly šipek místo textu
                const toggle = node.type === 'dir' ? `<span class="toggle">${node.open ? '▼' : '▶'}</span>` : '<span class="toggle"></span>';
                li.innerHTML = `${toggle}<span class="name" data-path="${node.path}">${node.name}</span>`;
                if (node.type === 'dir') {
                    const ul = document.createElement('ul');
                    ul.className = 'children';
                    renderTree(node.children, ul);
                    li.appendChild(ul);
                }
                parent.appendChild(li);
            });
        }

        function reHighlight() {
            document.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
        }

        async function loadFile(path) {
            const content = document.getElementById('content');
            content.innerHTML = `<div class="loading"><div class="spinner"></div><p>Načítám...</p></div>`;
            try {
                const res = await fetch(`${RAW_BASE}/${path}`);
                if (!res.ok) throw new Error();
                const md = await res.text();
                const title = path.split('/').pop().replace('.md', '');
                content.innerHTML = `<h1 class="doc-title">${title}</h1>` + marked.parse(md, { gfm: true, breaks: false });
                reHighlight();
                content.scrollTop = 0;
                document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
                document.querySelector(`[data-path="${path}"]`)?.closest('.tree-item')?.classList.add('active');
            } catch (e) {
                content.innerHTML = `<div class="loading"><p>Chyba: ${path}</p></div>`;
            }
        }

        // Theme
        let isDark = localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
        document.body.classList.toggle('dark', isDark);
        document.getElementById('theme-toggle').textContent = isDark ? 'Sun' : 'Moon';
        const lightLink = document.getElementById('hljs-light');
        const darkLink = document.getElementById('hljs-dark');
        function toggleTheme() {
            isDark = !isDark;
            document.body.classList.toggle('dark', isDark);
            document.getElementById('theme-toggle').textContent = isDark ? 'Sun' : 'Moon';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            lightLink.disabled = isDark;
            darkLink.disabled = !isDark;
            reHighlight();
        }

        // Events
        document.getElementById('theme-toggle').onclick = toggleTheme;
        document.getElementById('search').oninput = e => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('.name').forEach(el => {
                const show = term === '' || el.textContent.toLowerCase().includes(term);
                el.closest('.tree-item').style.display = show ? '' : 'none';
            });
        };
        document.getElementById('menu-btn').onclick = () => document.body.classList.toggle('sidebar-open');
        document.getElementById('overlay').onclick = () => document.body.classList.remove('sidebar-open');
        document.getElementById('fileTree').onclick = e => {
            const toggle = e.target.closest('.toggle');
            if (toggle && toggle.parentElement.classList.contains('tree-item')) {
                const li = toggle.parentElement;
                const open = li.classList.toggle('open');
                li.classList.toggle('collapsed', !open);
                // OPRAVENO: Používá symboly šipek místo textu
                toggle.textContent = open ? '▼' : '▶';
                return;
            }
            const name = e.target.closest('.name');
            if (name && name.dataset.path.endsWith('.md')) {
                loadFile(name.dataset.path);
                if (window.innerWidth < 768) document.body.classList.remove('sidebar-open');
            }
        };

        // Init
        async function init() {
            tree = await buildTree(ROOT_PATH);
            const treeEl = document.getElementById('fileTree');
            renderTree(tree, treeEl);
            const defaultFile = tree.flatMap(n => n.type === 'file' ? [n] : n.children || []).find(f => f.path.toLowerCase().endsWith(DEFAULT_FILE.toLowerCase())) || 
                               tree.flatMap(n => n.type === 'file' ? [n] : n.children || [])[0];
            if (defaultFile) loadFile(defaultFile.path);
        }
        init();
    </script>
</body>
</html>
